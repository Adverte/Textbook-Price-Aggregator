{% extends "base.html" %}

{% block head %}
<style type="text/css">
.book_data {
  min-height: 70px;
}
</style>

<script type="text/javascript">
$(function () {
    $.ajax({
        url: '{{ url }}',
        dataType: 'json',
        success: function(data) {
            output_results(data,'div#results');
        },
        beforeSend: function(jpXHR, settings) {
        	$('#results').hide();            
        	
        	$('<div class="overlay loader_img" />').appendTo('div#content').hide();
            $('div#content').css('min-height', '300px');
            $('.overlay').fadeIn();
        },
        complete: function(jqXHR, textStatus) {
        	$('#results').slideDown('slow', function() {
        		$('.overlay').fadeOut('slow', function() {
                    $('.overlay').remove()
                });
        	});
        }
    });
});

function output_results(data, selector)
{
    $.each(data, function(index, value) 
    {
        var book_container_id = 'book'+index;
        var book_container_sel = '#' + book_container_id;
        var params = {url: value.url, retailer: '{{retailer}}' };
        var url = '{{url2}}?' + $.param(params);
        
        $('<div id="'+book_container_id+'" />').appendTo(selector);
        
        var book_data_id = book_container_id + '_data';
        $('<div id="'+book_data_id+'" />').hover(function() {
                $(this).addClass('highlight');
            }, function() {
                $(this).removeClass('highlight');
            }).addClass('clickable')
              .addClass('book_data')
              .appendTo(book_container_sel);
        
        var imghtml = '<img class="bookimage" src="' + value.imageurl +'"></img>';
        var linkhtml = '<a href="' + url +'">' + value.title + '</a>';                                                   
        $(imghtml + linkhtml).appendTo('#' + book_data_id);
        
        $(book_container_sel).append('<hr/ class="clear">');
        
    }); // array each
    
    $("div.clickable").click( function() {
        window.location = $(this).children('a').attr('href');
        return false;
    });
}

</script>
{% endblock head %}

{% block content %}
<div id="results"></div>
{% endblock %}