{% extends "base.html" %}

{% block head %}
<script type="text/javascript" src="/js/output.js"></script>
<script type="text/javascript">
$(function () {
    get_results();
});

function get_results() 
{
    var overlay_container = '#content';
    var data_container = '#results';
    $.ajax({
        url: '{{ url }}',
        dataType: 'json',
        success: function(data) {
            if (data == '')
                $('#results').append('<h1>Try Again</h1><p>We were unable to find any matches for your search.<p>')
            else
                output_results(data,'#results');
        },
        beforeSend: function(jpXHR, settings) {
            $(data_container).hide();            
            $('<div />').appendTo(overlay_container)
                        .addClass('overlay loader_img')
                        .attr('id', 'results_overlay')
                        .hide();
            $(overlay_container).addClass('overlay_container');
            $('#results_overlay').fadeIn();
        },
        complete: function(jqXHR, textStatus) {
            $(data_container).slideDown('slow', function() {
                $('#results_overlay').fadeOut('slow', function() {
                    $(this).remove()
                    $(overlay_container).removeClass('overlay_container');
                });
            });
        }
    });
}

function output_results(data, selector)
{
    $.each(data, function(index, textbook) 
    {
        book_div = $('<div />').attr('id', 'book'+index)
                               .addClass('table')
                               .appendTo(selector);
        var params = {url: textbook.url, retailer: '{{retailer}}' };
        textbook.url = '{{url2}}?' + $.param(params);
        
        output.textbook(textbook, book_div)
        
        $(selector).append('<hr/ class="clear">');
        
    });
}

</script>
{% endblock head %}

{% block content %}
<div id="results"></div>
{% endblock %}